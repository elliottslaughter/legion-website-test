<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Privileges &#8211; Legion Programming System</title>
<meta name="description" content="">

<meta name="keywords" content="">


<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Privileges">
<meta property="og:description" content="Home page for the Legion parallel programming system">
<meta property="og:url" content="/legion-website-test/tutorial/privileges.html">
<meta property="og:site_name" content="Legion Programming System">





<link rel="canonical" href="/legion-website-test/tutorial/privileges.html">
<link href="/legion-website-test/feed.xml" type="application/atom+xml" rel="alternate" title="Legion Programming System Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='https://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<!-- For all browsers -->
<link rel="stylesheet" href="/legion-website-test/assets/css/main.min.css">

<!--[if (lt IE 9) & (!IEMobile)]>
<link rel="stylesheet" href="/legion-website-test/assets/css/ie.min.css">
<![endif]-->

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/legion-website-test/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<link rel="icon" sizes="16x16" href="/legion-website-test/images/favicon/favicon-16x16.png">
<link rel="icon" sizes="32x32" href="/legion-website-test/images/favicon/favicon-32x32.png">
<link rel="icon" sizes="48x48" href="/legion-website-test/images/favicon/favicon-48x48.png">
<link rel="icon" sizes="96x96" href="/legion-website-test/images/favicon/favicon-96x96.png">
<link rel="icon" sizes="144x144" href="/legion-website-test/images/favicon/favicon-144x144.png">
<link rel="icon" sizes="192x192" href="/legion-website-test/images/favicon/favicon-192x192.png">
<link rel="apple-touch-icon" sizes="57x57" href="/legion-website-test/images/favicon/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/legion-website-test/images/favicon/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/legion-website-test/images/favicon/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/legion-website-test/images/favicon/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/legion-website-test/images/favicon/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/legion-website-test/images/favicon/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/legion-website-test/images/favicon/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/legion-website-test/images/favicon/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/legion-website-test/images/favicon/apple-icon-180x180.png">
<link rel="apple-touch-icon-precomposed" sizes="192x192" href="/legion-website-test/images/favicon/apple-icon-precomposed.png">
<meta name="msapplication-config" content="/legion-website-test/images/favicon/browserconfig.xml" />
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<link rel="manifest" href="/legion-website-test/images/favicon/manifest.json">

</head>

<body class="page" itemscope itemtype="http://schema.org/WebPage">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="/legion-website-test/">Legion Programming System</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" itemscope itemtype="http://schema.org/SiteNavigationElement">
		    <ul>
		        
				<li><a href="/legion-website-test/overview/" >Overview</a></li>
		        
				<li><a href="/legion-website-test/starting/" >Getting Started</a></li>
		        
				<li><a href="/legion-website-test/tutorial/" >Tutorials</a></li>
		        
				<li><a href="/legion-website-test/events/" >Events</a></li>
		        
				<li><a href="/legion-website-test/documentation/" >Documentation</a></li>
		        
				<li><a href="/legion-website-test/publications/" >Publications</a></li>
		        
				<li><a href="/legion-website-test/resources/" >Resources</a></li>
		        
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->




<div id="main" role="main"  itemprop="mainContentOfPage">
  <div class="article-author-side">
    <a href="https://www.stanford.edu/"><img src="/legion-website-test/images/logos/stanford.png" class="bio-photo" alt="Stanford University logo"></a>
<a href="https://www6.slac.stanford.edu/"><img src="/legion-website-test/images/logos/slac.jpg" class="bio-photo" alt="SLAC National Accelerator Laboratory logo"></a>
<a href="https://www.lanl.gov/"><img src="/legion-website-test/images/logos/los-alamos.png" class="bio-photo" alt="Los Alamos National Laboratory logo"></a>
<a href="https://www.nvidia.com/"><img src="/legion-website-test/images/logos/nvidia.png" class="bio-photo" alt="NVIDIA logo"></a>
<a href="https://www.rdworldonline.com/rd-100-award-winners-announced-in-analytical-test-it-electrical-categories/"><img src="/legion-website-test/images/logos/rd100.png" class="bio-photo" alt="Winner of the R&D 100 Award"></a>

<h3>Legion</h3>
<p>High Productivity High Performance Computing</p>





<a href="http://github.com/StanfordLegion/legion" class="author-social" target="_blank"><i class="icon-github"></i> Github</a>



  </div>
  <article itemscope itemtype="http://schema.org/CreativeWork">
    <h1 itemprop="name">Privileges</h1>
    <div class="article-wrap" itemprop="text">
      <p>In this example we again implement DAXPY
but use a different approach that uses sub-tasks
to perform each of the different operations on
logical regions. We implement three different
sub-tasks: one for initializing a field of a
logical region with random data (lines 93-107),
one for performing the DAXPY computation
(lines 109-126), and one for checking the
results (lines 128-153). We show how to launch
sub-tasks that request access to logical regions,
how sub-tasks manage physical instances, and how
privileges are passed. We also discuss how operations
can be executed in parallel based on field
non-interference and further illustrate how
deferred execution works in Legion.</p>

<h4 id="task-region-requirements">Task Region Requirements</h4>

<p>In this example we launch sub-tasks to perform
all aspects of the DAXPY computation. The top-level
task begins by implementing the same region scheme
as was used in the previous example (lines 33-49).
The top-level task then launches sub-tasks for
initializing the two fields (lines 51-61), performing
the DAXPY computation (lines 64-73), and finally
for checking the result (lines 75-84). All task
launches are performing using <code class="language-plaintext highlighter-rouge">TaskLauncher</code>
objects which were introduced earlier in the tutorial
for launching a single sub-task. However, when
launching sub-tasks in this example, we also
pass <code class="language-plaintext highlighter-rouge">RegionRequirement</code> objects as part of the
task launches in order to specify the logical
regions on which the sub-tasks will operate.</p>

<p>Unlike inline mappings, sub-tasks can specify
an arbitrary number of <code class="language-plaintext highlighter-rouge">RegionRequirement</code> objects
in their launchers. The <code class="language-plaintext highlighter-rouge">RegionRequirement</code> objects
that are stored in an STL vector inside of the launcher
under the <code class="language-plaintext highlighter-rouge">region_requirements</code> field. <code class="language-plaintext highlighter-rouge">RegionRequirement</code>
objects can be added directly to the launcher or
by calling the <code class="language-plaintext highlighter-rouge">add_region_requirement</code> method on
the <code class="language-plaintext highlighter-rouge">TaskLauncher</code> (lines 52-53). For each of the
<code class="language-plaintext highlighter-rouge">RegionRequirement</code> objects requested by a sub-task
the Legion runtime will grant the sub-task the
requested <em>privileges</em> on the specified logical
regions on fields, thereby allowing the sub-task
to mutate the state of data in the logical regions
in ways consistent with the granted privileges.</p>

<h4 id="functional-region-privileges">Functional Region Privileges</h4>

<p>An important property of the Legion programming model
is that sub-tasks are only allowed to request privileges
which are a subset of their parent task’s privileges.
To enforce this invariant, privileges can only be passed
in a functional manner through sub-tasks calls. An astute
reader will notice that there is no mechanism either in
Legion or Regent for
naming privileges or storing them anywhere. Instead
privileges are only passed through <code class="language-plaintext highlighter-rouge">RegionRequirement</code>
objects used for launching sub-tasks. To reinforce the
functional nature of privileges <code class="language-plaintext highlighter-rouge">RegionRequirement</code>
objects require applications to name the parent task’s
logical region from which the sub-task (or inline
mapping or other operation) is obtaining privileges.</p>

<p>We now describe one instance of how privileges are
passed from the top-level task to one of its sub-tasks.
When a task creates a logical region it is granted full
read-write privileges for the created logical region.
When the top-level task create the <code class="language-plaintext highlighter-rouge">input_lr</code> and
<code class="language-plaintext highlighter-rouge">output_lr</code> logical regions it obtains full read-write
privileges on those regions. When the DAXPY sub-task
is invoked on lines 64-71, the sub-task is passed
<code class="language-plaintext highlighter-rouge">READ_ONLY</code> privileges on the <code class="language-plaintext highlighter-rouge">input_lr</code> for fields
<code class="language-plaintext highlighter-rouge">FID_X</code> and <code class="language-plaintext highlighter-rouge">FID_Y</code> and <code class="language-plaintext highlighter-rouge">WRITE_DISCARD</code> on field
<code class="language-plaintext highlighter-rouge">FID_Z</code>. The sub-task’s request for those privileges
is valid since they are a subset of the privileges
owned by the parent task. If a task that created a
logical region fails to delete it, the privileges
for the region implicitly escape into the parent
task’s context. If the privileges escape the top-level
task Legion will issue a warning noting that the
logical region was leaked.</p>

<p>There are four kinds of privileges: <code class="language-plaintext highlighter-rouge">READ_WRITE</code>,
<code class="language-plaintext highlighter-rouge">READ_ONLY</code>, <code class="language-plaintext highlighter-rouge">REDUCE</code>, and <code class="language-plaintext highlighter-rouge">WRITE_DISCARD</code>. <code class="language-plaintext highlighter-rouge">READ_WRITE</code>
privileges give the task full permission to mutate
the specified fields of the logical region using any
kind of operation (read, write, reduction). <code class="language-plaintext highlighter-rouge">READ_ONLY</code>
restricts the task to only be able to perform reads
and <code class="language-plaintext highlighter-rouge">REDUCE</code> restricts the task to only be able to
perform reductions. <code class="language-plaintext highlighter-rouge">WRITE_DISCARD</code> is a special form
of <code class="language-plaintext highlighter-rouge">READ_WRITE</code> that still permits the task to perform
any kind of operation, but informs the runtime that
the task intends to overwrite all previous data stored
in the logical region without reading it. This enables
the runtime to perform several performance optimizations
associated with removing unnecessary data movement
operations. The various kinds of privileges form a
semi-lattice with <code class="language-plaintext highlighter-rouge">READ_WRITE</code> and <code class="language-plaintext highlighter-rouge">WRITE_DISCARD</code>
privileges occupying the top position and <code class="language-plaintext highlighter-rouge">READ_ONLY</code>
and <code class="language-plaintext highlighter-rouge">REDUCE</code> privileges each representing a subset
of the top privileges. The bottom element represents
having no privileges.</p>

<p>The privilege system of the Legion programming model
is essential to both the correctness and performance
of Legion applications. Privilege passing is
checked by the Legion runtime and will result in
runtime errors if violated. In Regent, privilege passing is checked statically
by the type system resulting in easier to diagnose
compile-time errors. The enforcement of functional
privilege passing makes possible Legion’s hierarchical
and distributed scheduling algorithm. For more details
on this we refer you to our
<a href="/legion-website-test/publications/">publications</a>.</p>

<h4 id="task-physical-regions">Task Physical Regions</h4>

<p>When a task requests privileges on logical regions
using <code class="language-plaintext highlighter-rouge">RegionRequirement</code> objects, it is commonly
the case that the task will need physical instances
of these requested regions. If a task was launched
with N region requirements, then it will be passed
back N <code class="language-plaintext highlighter-rouge">PhysicalRegion</code> objects in the <code class="language-plaintext highlighter-rouge">region</code>
STL vector that is an argument to all Legion tasks
(line 94). The <code class="language-plaintext highlighter-rouge">PhysicalRegion</code> objects are identical
to the ones described in the previous example that
are used to name physical instances. The only
difference in this case is that the Legion runtime
is intelligent about starting tasks that need
<code class="language-plaintext highlighter-rouge">PhysicalRegion</code> objects, and will not begin
execution of the task until all of the <code class="language-plaintext highlighter-rouge">PhysicalRegion</code>
objects are valid.</p>

<p>In general, most Legion application tasks will map
all of their logical region requests to physical
instances as part of their mapping phase (discussed
in a coming example). However, in some cases tasks
need only pass privileges for accessing a region
without needing an explicit physical instance. In
these cases, the <em>mapper</em> which maps the task may
request that one or more logical region requirements
be <em>virtually mapped</em>. In these cases no physical
instance is created, but the task is still granted
privileges for the requested logical region and fields.
Tasks can test whether a <code class="language-plaintext highlighter-rouge">PhysicalRegion</code> has been
virtually mapped by invoking the <code class="language-plaintext highlighter-rouge">is_mapped</code> method
which will return <code class="language-plaintext highlighter-rouge">false</code> if virtually mapped.
The Legion default mapper will never virtually map
a region, but other mappers may choose to do so
and tasks should be implemented to handle such
scenarios.</p>

<p>The original <code class="language-plaintext highlighter-rouge">RegionRequirement</code> objects that were
used to launch a task are available to the task
implementation via the <code class="language-plaintext highlighter-rouge">Task</code> object. The <code class="language-plaintext highlighter-rouge">regions</code>
field of the <code class="language-plaintext highlighter-rouge">Task</code> object is an STL vector
containing the passed <code class="language-plaintext highlighter-rouge">RegionRequirement</code> objects.
Having access to these arguments is very powerful
as it even permits the implementation of
<em>field-polymorphic</em> tasks which can perform the
same operation on a dynamically determined set
of fields. For example, in our DAXPY example,
the <code class="language-plaintext highlighter-rouge">init_field_task</code> is a field-polymorphic
function as it examines the <code class="language-plaintext highlighter-rouge">RegionRequirement</code>
passed to it to see which field to initialize
(line 99). We can therefore use the same task
to initialize both the <code class="language-plaintext highlighter-rouge">X</code> and <code class="language-plaintext highlighter-rouge">Y</code> fields.
Field-polymorphic tasks occur regularly in Legion
as it is common for many applications to want
to perform the same operation over many different
fields using a single task implementation.</p>

<h4 id="deferred-execution-revisited">Deferred Execution Revisited</h4>

<p>The top-level task in this implementation of DAXPY
has a very interesting property: it never records
any <code class="language-plaintext highlighter-rouge">Future</code> objects as part of its sub-task
launches (lines 55,61,73,84). As a result there is
no way for it to explicitly block execution or chain
dependences between sub-tasks. Furthermore, because
all task launches are deferred, it’s possible for
the top-level task to launch all its sub-tasks and
finish executing even before the first sub-task begins
running. So how is it possible that this application
computes the correct answer?</p>

<p>The crucial insight is that Legion understands the
structure of program data (in this case the two
logical regions <code class="language-plaintext highlighter-rouge">input_lr</code> and <code class="language-plaintext highlighter-rouge">output_lr</code> and their
fields). As the top-level task executes, Legion computes
a <em>Task Dataflow Graph</em> (TDG) which captures data
dependences between operations based on the logical
regions, fields, and privileges that operations request.
Dependences in legion are computed based on the
<strong>program order</strong> in which operations are issued to
the runtime. Legion therefore maintains sequential
execution semantics for all operations, even though
operations may ultimately execute in parallel. By
maintaining sequential execution semantics, Legion
significantly simplifies reasoning about operations
within a task. The following figure shows the computed
TDG for this DAXPY example:</p>

<p><img src="/legion-website-test/images/daxpy_sequential.svg" alt="" /></p>

<p>In this figure we see that the DAXPY task has data
dependences on the two field initialization tasks
(one on field <code class="language-plaintext highlighter-rouge">X</code> and one on field <code class="language-plaintext highlighter-rouge">Y</code> of the <code class="language-plaintext highlighter-rouge">input_lr</code>
logical region). The checking
task then has a data dependence on the DAXPY task
(on field <code class="language-plaintext highlighter-rouge">Z</code> of the <code class="language-plaintext highlighter-rouge">output_lr</code> region). (There are
also transitive data dependences from the initialization
tasks to the checking task on the two fields of <code class="language-plaintext highlighter-rouge">input_lr</code>
but we omit them for simplicity.) Finally, the deletions
of the two logical regions must wait until the last task
using the regions finishes executing. Legion is able to
efficiently compute this graph because it knows about
the structure of program data in the form of logical
regions as well as how tasks use logical regions.</p>

<p>By constructing the TDG for every task execution, Legion
can defer all the operations launched within a task
context. It is important to note that this is strictly
more powerful that traditional asynchronous execution.
In asynchronous execution, operations can be launched
asynchronously only once all their input dependences
have been satisfied. On the other hand, in a deferred
execution model such as Legion’s, sub-tasks and other
operations can be issued even before dependences have
been satisfied. Doing so ensures as many operations
as possible are in flight, allowing the runtime to
discover the full parallelism available in applications,
make maximal use of machine resources, and hide long
latency operations with parallel work.</p>

<p>While all the sub-tasks executed within a task’s context
are deferred, a task is not permitted to be considered <em>complete</em> until
all of its sub-tasks have completed. In our DAXPY example,
this prevents the top-level task from completing until
all the sub-tasks and deletion operations are complete.
Legion automatically manages this phase of a task’s execution.</p>

<h4 id="field-level-non-interference">Field-Level Non-Interference</h4>

<p>Determining that two sub-tasks have <em>non-interfering</em>
<code class="language-plaintext highlighter-rouge">RegionRequirement</code> objects is how Legion implicitly
extracts parallelism from applications. There are three
forms of non-interference:</p>

<ul>
  <li><strong>Region non-interference</strong>: two <code class="language-plaintext highlighter-rouge">RegionRequirement</code> objects
are non-interfering on regions if they access logical
regions from different region trees, or disjoint logical
regions in the same tree.</li>
  <li><strong>Field-level non-interference</strong>: two <code class="language-plaintext highlighter-rouge">RegionRequirement</code>
objects are non-interfering on fields if they access
disjoint sets of fields within the same logical region.</li>
  <li><strong>Privileges non-interference</strong>: two <code class="language-plaintext highlighter-rouge">RegionRequirement</code>
objects are non-interfering on privileges if they
are both request <code class="language-plaintext highlighter-rouge">READ_ONLY</code> privileges, or they
both request <code class="language-plaintext highlighter-rouge">REDUCE</code> privileges with the same
reduction operator.</li>
</ul>

<p>We’ll see examples of region and privilege non-interference
in the next two examples. In this DAXPY example we have
an example of field-level non-interference. Both
of the <code class="language-plaintext highlighter-rouge">init_field_task</code> launches request the same
logical region with <code class="language-plaintext highlighter-rouge">WRITE_DISCARD</code> privilege and therefore
neither region nor privilege non-interference applies. However,
because the <code class="language-plaintext highlighter-rouge">RegionRequirement</code> objects request privileges
on different fields, the two sets of fields are disjoint.
Thus, even though the two <code class="language-plaintext highlighter-rouge">init_field_task</code> launches are
performed sequentially, Legion infers that the tasks can
be run in parallel. This is reflected in the TDG where
there are no data dependence edges between the nodes for
the two tasks.</p>

<p>It is important to note that even though Legion has
determined that these two tasks may be run in parallel,
it is up to the mapper to assign them to different processors.
If they are assigned to the same processor, Legion will
serialize their execution, resulting in correct but
sequential behavior. This is just one example of how
mapping decisions can influence the performance of applications.
We’ll investigate the mapping process in more detail in
a later example.</p>

<p>Next Example: <a href="/legion-website-test/tutorial/partitioning.html">Partitioning</a><br />
Previous Example: <a href="/legion-website-test/tutorial/physical_regions.html">Physical Regions</a></p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
</pre></td><td class="code"><pre><span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;cassert&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;cstdlib&gt;</span><span class="cp">
#include</span> <span class="cpf">"legion.h"</span><span class="cp">
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">Legion</span><span class="p">;</span>

<span class="k">enum</span> <span class="n">TaskIDs</span> <span class="p">{</span>
  <span class="n">TOP_LEVEL_TASK_ID</span><span class="p">,</span>
  <span class="n">INIT_FIELD_TASK_ID</span><span class="p">,</span>
  <span class="n">DAXPY_TASK_ID</span><span class="p">,</span>
  <span class="n">CHECK_TASK_ID</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">FieldIDs</span> <span class="p">{</span>
  <span class="n">FID_X</span><span class="p">,</span>
  <span class="n">FID_Y</span><span class="p">,</span>
  <span class="n">FID_Z</span><span class="p">,</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">top_level_task</span><span class="p">(</span><span class="k">const</span> <span class="n">Task</span> <span class="o">*</span><span class="n">task</span><span class="p">,</span>
                    <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">PhysicalRegion</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">regions</span><span class="p">,</span>
                    <span class="n">Context</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">Runtime</span> <span class="o">*</span><span class="n">runtime</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">num_elements</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>
  <span class="p">{</span>
    <span class="k">const</span> <span class="n">InputArgs</span> <span class="o">&amp;</span><span class="n">command_args</span> <span class="o">=</span> <span class="n">Runtime</span><span class="o">::</span><span class="n">get_input_args</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">command_args</span><span class="p">.</span><span class="n">argc</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">command_args</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s">"-n"</span><span class="p">))</span>
        <span class="n">num_elements</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">command_args</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="o">++</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Running daxpy for %d elements...</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">num_elements</span><span class="p">);</span>

  <span class="k">const</span> <span class="n">Rect</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">elem_rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">num_elements</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">IndexSpace</span> <span class="n">is</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">create_index_space</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">elem_rect</span><span class="p">);</span>
  <span class="n">FieldSpace</span> <span class="n">input_fs</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">create_field_space</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
  <span class="p">{</span>
    <span class="n">FieldAllocator</span> <span class="n">allocator</span> <span class="o">=</span>
      <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">create_field_allocator</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">input_fs</span><span class="p">);</span>
    <span class="n">allocator</span><span class="p">.</span><span class="n">allocate_field</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">),</span><span class="n">FID_X</span><span class="p">);</span>
    <span class="n">allocator</span><span class="p">.</span><span class="n">allocate_field</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">),</span><span class="n">FID_Y</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">FieldSpace</span> <span class="n">output_fs</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">create_field_space</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
  <span class="p">{</span>
    <span class="n">FieldAllocator</span> <span class="n">allocator</span> <span class="o">=</span>
      <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">create_field_allocator</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">output_fs</span><span class="p">);</span>
    <span class="n">allocator</span><span class="p">.</span><span class="n">allocate_field</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">),</span><span class="n">FID_Z</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">LogicalRegion</span> <span class="n">input_lr</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">create_logical_region</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">is</span><span class="p">,</span> <span class="n">input_fs</span><span class="p">);</span>
  <span class="n">LogicalRegion</span> <span class="n">output_lr</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">create_logical_region</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">is</span><span class="p">,</span> <span class="n">output_fs</span><span class="p">);</span>

  <span class="n">TaskLauncher</span> <span class="n">init_launcher</span><span class="p">(</span><span class="n">INIT_FIELD_TASK_ID</span><span class="p">,</span> <span class="n">TaskArgument</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
  <span class="n">init_launcher</span><span class="p">.</span><span class="n">add_region_requirement</span><span class="p">(</span>
      <span class="n">RegionRequirement</span><span class="p">(</span><span class="n">input_lr</span><span class="p">,</span> <span class="n">WRITE_DISCARD</span><span class="p">,</span> <span class="n">EXCLUSIVE</span><span class="p">,</span> <span class="n">input_lr</span><span class="p">));</span>
  <span class="n">init_launcher</span><span class="p">.</span><span class="n">add_field</span><span class="p">(</span><span class="mi">0</span><span class="cm">/*idx*/</span><span class="p">,</span> <span class="n">FID_X</span><span class="p">);</span>
  <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">execute_task</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">init_launcher</span><span class="p">);</span>

  <span class="n">init_launcher</span><span class="p">.</span><span class="n">region_requirements</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">privilege_fields</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
  <span class="n">init_launcher</span><span class="p">.</span><span class="n">region_requirements</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">instance_fields</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
  <span class="n">init_launcher</span><span class="p">.</span><span class="n">add_field</span><span class="p">(</span><span class="mi">0</span><span class="cm">/*idx*/</span><span class="p">,</span> <span class="n">FID_Y</span><span class="p">);</span>

  <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">execute_task</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">init_launcher</span><span class="p">);</span>

  <span class="k">const</span> <span class="kt">double</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">drand48</span><span class="p">();</span>
  <span class="n">TaskLauncher</span> <span class="n">daxpy_launcher</span><span class="p">(</span><span class="n">DAXPY_TASK_ID</span><span class="p">,</span> <span class="n">TaskArgument</span><span class="p">(</span><span class="o">&amp;</span><span class="n">alpha</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">alpha</span><span class="p">)));</span>
  <span class="n">daxpy_launcher</span><span class="p">.</span><span class="n">add_region_requirement</span><span class="p">(</span>
      <span class="n">RegionRequirement</span><span class="p">(</span><span class="n">input_lr</span><span class="p">,</span> <span class="n">READ_ONLY</span><span class="p">,</span> <span class="n">EXCLUSIVE</span><span class="p">,</span> <span class="n">input_lr</span><span class="p">));</span>
  <span class="n">daxpy_launcher</span><span class="p">.</span><span class="n">add_field</span><span class="p">(</span><span class="mi">0</span><span class="cm">/*idx*/</span><span class="p">,</span> <span class="n">FID_X</span><span class="p">);</span>
  <span class="n">daxpy_launcher</span><span class="p">.</span><span class="n">add_field</span><span class="p">(</span><span class="mi">0</span><span class="cm">/*idx*/</span><span class="p">,</span> <span class="n">FID_Y</span><span class="p">);</span>
  <span class="n">daxpy_launcher</span><span class="p">.</span><span class="n">add_region_requirement</span><span class="p">(</span>
      <span class="n">RegionRequirement</span><span class="p">(</span><span class="n">output_lr</span><span class="p">,</span> <span class="n">WRITE_DISCARD</span><span class="p">,</span> <span class="n">EXCLUSIVE</span><span class="p">,</span> <span class="n">output_lr</span><span class="p">));</span>
  <span class="n">daxpy_launcher</span><span class="p">.</span><span class="n">add_field</span><span class="p">(</span><span class="mi">1</span><span class="cm">/*idx*/</span><span class="p">,</span> <span class="n">FID_Z</span><span class="p">);</span>

  <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">execute_task</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">daxpy_launcher</span><span class="p">);</span>

  <span class="n">TaskLauncher</span> <span class="n">check_launcher</span><span class="p">(</span><span class="n">CHECK_TASK_ID</span><span class="p">,</span> <span class="n">TaskArgument</span><span class="p">(</span><span class="o">&amp;</span><span class="n">alpha</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">alpha</span><span class="p">)));</span>
  <span class="n">check_launcher</span><span class="p">.</span><span class="n">add_region_requirement</span><span class="p">(</span>
      <span class="n">RegionRequirement</span><span class="p">(</span><span class="n">input_lr</span><span class="p">,</span> <span class="n">READ_ONLY</span><span class="p">,</span> <span class="n">EXCLUSIVE</span><span class="p">,</span> <span class="n">input_lr</span><span class="p">));</span>
  <span class="n">check_launcher</span><span class="p">.</span><span class="n">add_field</span><span class="p">(</span><span class="mi">0</span><span class="cm">/*idx*/</span><span class="p">,</span> <span class="n">FID_X</span><span class="p">);</span>
  <span class="n">check_launcher</span><span class="p">.</span><span class="n">add_field</span><span class="p">(</span><span class="mi">0</span><span class="cm">/*idx*/</span><span class="p">,</span> <span class="n">FID_Y</span><span class="p">);</span>
  <span class="n">check_launcher</span><span class="p">.</span><span class="n">add_region_requirement</span><span class="p">(</span>
      <span class="n">RegionRequirement</span><span class="p">(</span><span class="n">output_lr</span><span class="p">,</span> <span class="n">READ_ONLY</span><span class="p">,</span> <span class="n">EXCLUSIVE</span><span class="p">,</span> <span class="n">output_lr</span><span class="p">));</span>
  <span class="n">check_launcher</span><span class="p">.</span><span class="n">add_field</span><span class="p">(</span><span class="mi">1</span><span class="cm">/*idx*/</span><span class="p">,</span> <span class="n">FID_Z</span><span class="p">);</span>

  <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">execute_task</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">check_launcher</span><span class="p">);</span>

  <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">destroy_logical_region</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">input_lr</span><span class="p">);</span>
  <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">destroy_logical_region</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">output_lr</span><span class="p">);</span>
  <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">destroy_field_space</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">input_fs</span><span class="p">);</span>
  <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">destroy_field_space</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">output_fs</span><span class="p">);</span>
  <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">destroy_index_space</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">is</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">init_field_task</span><span class="p">(</span><span class="k">const</span> <span class="n">Task</span> <span class="o">*</span><span class="n">task</span><span class="p">,</span>
                     <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">PhysicalRegion</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">regions</span><span class="p">,</span>
                     <span class="n">Context</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">Runtime</span> <span class="o">*</span><span class="n">runtime</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">regions</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">task</span><span class="o">-&gt;</span><span class="n">regions</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">task</span><span class="o">-&gt;</span><span class="n">regions</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">privilege_fields</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">FieldID</span> <span class="n">fid</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">task</span><span class="o">-&gt;</span><span class="n">regions</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">privilege_fields</span><span class="p">.</span><span class="n">begin</span><span class="p">());</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Initializing field %d...</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">fid</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">FieldAccessor</span><span class="o">&lt;</span><span class="n">WRITE_DISCARD</span><span class="p">,</span><span class="kt">double</span><span class="p">,</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">acc</span><span class="p">(</span><span class="n">regions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fid</span><span class="p">);</span>

  <span class="n">Rect</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">rect</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">get_index_space_domain</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span>
                  <span class="n">task</span><span class="o">-&gt;</span><span class="n">regions</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">region</span><span class="p">.</span><span class="n">get_index_space</span><span class="p">());</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">PointInRectIterator</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">pir</span><span class="p">(</span><span class="n">rect</span><span class="p">);</span> <span class="n">pir</span><span class="p">();</span> <span class="n">pir</span><span class="o">++</span><span class="p">)</span>
    <span class="n">acc</span><span class="p">[</span><span class="o">*</span><span class="n">pir</span><span class="p">]</span> <span class="o">=</span> <span class="n">drand48</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">daxpy_task</span><span class="p">(</span><span class="k">const</span> <span class="n">Task</span> <span class="o">*</span><span class="n">task</span><span class="p">,</span>
                <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">PhysicalRegion</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">regions</span><span class="p">,</span>
                <span class="n">Context</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">Runtime</span> <span class="o">*</span><span class="n">runtime</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">regions</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">task</span><span class="o">-&gt;</span><span class="n">regions</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">task</span><span class="o">-&gt;</span><span class="n">arglen</span> <span class="o">==</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
  <span class="k">const</span> <span class="kt">double</span> <span class="n">alpha</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">task</span><span class="o">-&gt;</span><span class="n">args</span><span class="p">);</span>

  <span class="k">const</span> <span class="n">FieldAccessor</span><span class="o">&lt;</span><span class="n">READ_ONLY</span><span class="p">,</span><span class="kt">double</span><span class="p">,</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">acc_x</span><span class="p">(</span><span class="n">regions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">FID_X</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">FieldAccessor</span><span class="o">&lt;</span><span class="n">READ_ONLY</span><span class="p">,</span><span class="kt">double</span><span class="p">,</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">acc_y</span><span class="p">(</span><span class="n">regions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">FID_Y</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">FieldAccessor</span><span class="o">&lt;</span><span class="n">WRITE_DISCARD</span><span class="p">,</span><span class="kt">double</span><span class="p">,</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">acc_z</span><span class="p">(</span><span class="n">regions</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">FID_Z</span><span class="p">);</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">"Running daxpy computation with alpha %.8g...</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">alpha</span><span class="p">);</span>
  <span class="n">Rect</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">rect</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">get_index_space_domain</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span>
                  <span class="n">task</span><span class="o">-&gt;</span><span class="n">regions</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">region</span><span class="p">.</span><span class="n">get_index_space</span><span class="p">());</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">PointInRectIterator</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">pir</span><span class="p">(</span><span class="n">rect</span><span class="p">);</span> <span class="n">pir</span><span class="p">();</span> <span class="n">pir</span><span class="o">++</span><span class="p">)</span>
    <span class="n">acc_z</span><span class="p">[</span><span class="o">*</span><span class="n">pir</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">acc_x</span><span class="p">[</span><span class="o">*</span><span class="n">pir</span><span class="p">]</span> <span class="o">+</span> <span class="n">acc_y</span><span class="p">[</span><span class="o">*</span><span class="n">pir</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">check_task</span><span class="p">(</span><span class="k">const</span> <span class="n">Task</span> <span class="o">*</span><span class="n">task</span><span class="p">,</span>
                <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">PhysicalRegion</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">regions</span><span class="p">,</span>
                <span class="n">Context</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">Runtime</span> <span class="o">*</span><span class="n">runtime</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">regions</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">task</span><span class="o">-&gt;</span><span class="n">regions</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">);</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">task</span><span class="o">-&gt;</span><span class="n">arglen</span> <span class="o">==</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
  <span class="k">const</span> <span class="kt">double</span> <span class="n">alpha</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="k">const</span> <span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">task</span><span class="o">-&gt;</span><span class="n">args</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">FieldAccessor</span><span class="o">&lt;</span><span class="n">READ_ONLY</span><span class="p">,</span><span class="kt">double</span><span class="p">,</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">acc_x</span><span class="p">(</span><span class="n">regions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">FID_X</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">FieldAccessor</span><span class="o">&lt;</span><span class="n">READ_ONLY</span><span class="p">,</span><span class="kt">double</span><span class="p">,</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">acc_y</span><span class="p">(</span><span class="n">regions</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">FID_Y</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">FieldAccessor</span><span class="o">&lt;</span><span class="n">READ_ONLY</span><span class="p">,</span><span class="kt">double</span><span class="p">,</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">acc_z</span><span class="p">(</span><span class="n">regions</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">FID_Z</span><span class="p">);</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">"Checking results..."</span><span class="p">);</span>
  <span class="n">Rect</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">rect</span> <span class="o">=</span> <span class="n">runtime</span><span class="o">-&gt;</span><span class="n">get_index_space_domain</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span>
                  <span class="n">task</span><span class="o">-&gt;</span><span class="n">regions</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">region</span><span class="p">.</span><span class="n">get_index_space</span><span class="p">());</span>
  <span class="kt">bool</span> <span class="n">all_passed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">PointInRectIterator</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">pir</span><span class="p">(</span><span class="n">rect</span><span class="p">);</span> <span class="n">pir</span><span class="p">();</span> <span class="n">pir</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">double</span> <span class="n">expected</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">acc_x</span><span class="p">[</span><span class="o">*</span><span class="n">pir</span><span class="p">]</span> <span class="o">+</span> <span class="n">acc_y</span><span class="p">[</span><span class="o">*</span><span class="n">pir</span><span class="p">];</span>
    <span class="kt">double</span> <span class="n">received</span> <span class="o">=</span> <span class="n">acc_z</span><span class="p">[</span><span class="o">*</span><span class="n">pir</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">expected</span> <span class="o">!=</span> <span class="n">received</span><span class="p">)</span>
      <span class="n">all_passed</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">all_passed</span><span class="p">)</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"SUCCESS!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"FAILURE!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Runtime</span><span class="o">::</span><span class="n">set_top_level_task_id</span><span class="p">(</span><span class="n">TOP_LEVEL_TASK_ID</span><span class="p">);</span>

  <span class="p">{</span>
    <span class="n">TaskVariantRegistrar</span> <span class="n">registrar</span><span class="p">(</span><span class="n">TOP_LEVEL_TASK_ID</span><span class="p">,</span> <span class="s">"top_level"</span><span class="p">);</span>
    <span class="n">registrar</span><span class="p">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">ProcessorConstraint</span><span class="p">(</span><span class="n">Processor</span><span class="o">::</span><span class="n">LOC_PROC</span><span class="p">));</span>
    <span class="n">Runtime</span><span class="o">::</span><span class="n">preregister_task_variant</span><span class="o">&lt;</span><span class="n">top_level_task</span><span class="o">&gt;</span><span class="p">(</span><span class="n">registrar</span><span class="p">,</span> <span class="s">"top_level"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="p">{</span>
    <span class="n">TaskVariantRegistrar</span> <span class="n">registrar</span><span class="p">(</span><span class="n">INIT_FIELD_TASK_ID</span><span class="p">,</span> <span class="s">"init_field"</span><span class="p">);</span>
    <span class="n">registrar</span><span class="p">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">ProcessorConstraint</span><span class="p">(</span><span class="n">Processor</span><span class="o">::</span><span class="n">LOC_PROC</span><span class="p">));</span>
    <span class="n">registrar</span><span class="p">.</span><span class="n">set_leaf</span><span class="p">();</span>
    <span class="n">Runtime</span><span class="o">::</span><span class="n">preregister_task_variant</span><span class="o">&lt;</span><span class="n">init_field_task</span><span class="o">&gt;</span><span class="p">(</span><span class="n">registrar</span><span class="p">,</span> <span class="s">"init_field"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="p">{</span>
    <span class="n">TaskVariantRegistrar</span> <span class="n">registrar</span><span class="p">(</span><span class="n">DAXPY_TASK_ID</span><span class="p">,</span> <span class="s">"daxpy"</span><span class="p">);</span>
    <span class="n">registrar</span><span class="p">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">ProcessorConstraint</span><span class="p">(</span><span class="n">Processor</span><span class="o">::</span><span class="n">LOC_PROC</span><span class="p">));</span>
    <span class="n">registrar</span><span class="p">.</span><span class="n">set_leaf</span><span class="p">();</span>
    <span class="n">Runtime</span><span class="o">::</span><span class="n">preregister_task_variant</span><span class="o">&lt;</span><span class="n">daxpy_task</span><span class="o">&gt;</span><span class="p">(</span><span class="n">registrar</span><span class="p">,</span> <span class="s">"daxpy"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="p">{</span>
    <span class="n">TaskVariantRegistrar</span> <span class="n">registrar</span><span class="p">(</span><span class="n">CHECK_TASK_ID</span><span class="p">,</span> <span class="s">"check"</span><span class="p">);</span>
    <span class="n">registrar</span><span class="p">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">ProcessorConstraint</span><span class="p">(</span><span class="n">Processor</span><span class="o">::</span><span class="n">LOC_PROC</span><span class="p">));</span>
    <span class="n">registrar</span><span class="p">.</span><span class="n">set_leaf</span><span class="p">();</span>
    <span class="n">Runtime</span><span class="o">::</span><span class="n">preregister_task_variant</span><span class="o">&lt;</span><span class="n">check_task</span><span class="o">&gt;</span><span class="p">(</span><span class="n">registrar</span><span class="p">,</span> <span class="s">"check"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">Runtime</span><span class="o">::</span><span class="n">start</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></figure>


    </div><!-- /.article-wrap -->
  </article>
</div><!-- /#index -->

<div class="footer-wrap">
  <footer>
    <span>&copy; 2023 Legion. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/legion-website-test/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/legion-website-test/assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-20524102-3']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

          

</body>
</html>
